var gutil, through, jade, fs, path;
gutil = require('gulp-util');
through = require('through2');
jade = require('jade');
fs = require('fs');
path = require('path');
module.exports = function(template){
  var transform;
  transform = function(file, encoding, callback){
    var p, fn, html, err;
    if (template == null) {
      return callback(new gutil.PluginError('gulp-jade-template', 'Template not found'));
    }
    if (file.isNull()) {
      return callback(null, file);
    }
    if (file.isStream()) {
      return callback(new gutil.PluginError('gulp-jade-template', 'Stream not supported'));
    }
    try {
      p = path.resolve(process.cwd(), template);
      fn = jade.compileFile(p);
      html = fn(JSON.parse(file.contents.toString()));
    } catch (e$) {
      err = e$;
      console.log(err);
      return callback(new gutil.PluginError('gulp-jade-template', 'Jade compile error'));
    }
    file.contents = new Buffer(html);
    return callback(null, file);
  };
  return through.obj(transform);
};